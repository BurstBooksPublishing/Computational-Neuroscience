import numpy as np
import matplotlib.pyplot as plt

# Parameters
N = 100  # Number of neurons
T = 1000  # Simulation time (ms)
dt = 0.1  # Time step (ms)
a = 0.02  # Izhikevich parameter a
b = 0.2  # Izhikevich parameter b
c = -65  # Izhikevich parameter c
d = 8  # Izhikevich parameter d
I_ext = 5  # External current
K = 0.1  # Coupling strength

# Initialization
v = np.full(N, c)  # Membrane potential
u = np.full(N, b * v)  # Recovery variable
s = np.zeros(N)  # Synaptic gating variable
spikes = np.zeros((N, T))  # Spike trains

# Simulation loop
for t in range(T):
    for i in range(N):
        dv = (0.04 * v[i]**2 + 5 * v[i] + 140 - u[i] + I_ext + K * np.sum(s)) * dt
        du = (a * (b * v[i] - u[i])) * dt
        v[i] += dv
        u[i] += du
        if v[i] >= 30:
            v[i] = c
            u[i] += d
            spikes[i, t] = 1
        s[i] = s[i] * np.exp(-dt / 5) + spikes[i, t]

# Plot raster plot
plt.figure()
for i in range(N):
    spike_times = np.where(spikes[i, :] == 1)[0]
    plt.plot(spike_times, i * np.ones_like(spike_times), 'k.', markersize=1)
plt.xlabel('Time (ms)')
plt.ylabel('Neuron index')
plt.title('Raster plot of spiking activity')
plt.show()