import numpy as np
import matplotlib.pyplot as plt

# Parameters
C_m = 200e-12  # Membrane capacitance (F)
g_L = 10e-9    # Leak conductance (S)
E_L = -65e-3   # Leak reversal potential (V)
V_T = -50e-3   # Threshold potential (V)
Delta_T = 2e-3 # Slope factor (V)
tau_w = 100e-3 # Adaptation time constant (s)
a = 4e-9       # Subthreshold adaptation conductance (S)
b = 0.02e-9    # Spike-triggered adaptation increment (A)
V_reset = -70e-3 # Reset potential (V)
V_peak = 20e-3  # Peak potential (V)
I_ext = 500e-12 # External current (A)

# Simulation parameters
dt = 0.1e-3    # Time step (s)
T = 1.0        # Total simulation time (s)
steps = int(T / dt)

# Initial conditions
V = E_L        # Membrane potential (V)
w = 0          # Adaptation variable (A)

# Arrays to store results
V_trace = np.zeros(steps)
w_trace = np.zeros(steps)

# Simulation loop
for i in range(steps):
    # Update membrane potential
    dV_dt = (-g_L * (V - E_L) + g_L * Delta_T * np.exp((V - V_T) / Delta_T) - w + I_ext) / C_m
    V += dV_dt * dt
    
    # Update adaptation variable
    dw_dt = (a * (V - E_L) - w) / tau_w
    w += dw_dt * dt
    
    # Spike detection and reset
    if V >= V_peak:
        V = V_reset
        w += b
    
    # Store results
    V_trace[i] = V
    w_trace[i] = w

# Plot results
time = np.arange(0, T, dt)
plt.plot(time, V_trace)
plt.xlabel('Time (s)')
plt.ylabel('Membrane Potential (V)')
plt.title('AdEx Model Simulation')
plt.show()